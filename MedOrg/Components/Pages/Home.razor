@page "/"
@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims
@inject AuthenticationStateProvider AuthStateProvider
@rendermode InteractiveServer

<PageTitle>MedOrg - Главная</PageTitle>

<div class="container-fluid py-5">
    <div class="row">
        <div class="col-12 text-center mb-4">
            <h1>🏥 Добро пожаловать в MedOrg</h1>
            <p class="lead">Информационная система управления медицинскими учреждениями</p>
        </div>
    </div>

    <AuthorizeView>
        <Authorized>
            <div class="row mb-4">
                <div class="col-12">
                    <div class="alert alert-info">
                        <h4>🔍 Диагностическая информация</h4>
                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Имя пользователя:</strong> @context.User.Identity?.Name</p>
                                <p><strong>Email:</strong> @context.User.FindFirst(ClaimTypes.Email)?.Value</p>
                                <p><strong>User ID:</strong> @context.User.FindFirst(ClaimTypes.NameIdentifier)?.Value</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Роли:</strong></p>
                                <ul>
                                    @foreach (var claim in context.User.Claims.Where(c => c.Type == ClaimTypes.Role))
                                    {
                                        <li>
                                            <span class="badge bg-primary">@claim.Value</span>
                                        </li>
                                    }
                                </ul>
                                <p><strong>Все Claims:</strong></p>
                                <ul style="max-height: 200px; overflow-y: auto;">
                                    @foreach (var claim in context.User.Claims)
                                    {
                                        <li><small>@claim.Type: @claim.Value</small></li>
                                    }
                                </ul>
                            </div>
                        </div>

                        <hr>
                        <h5>Проверка ролей:</h5>
                        <p>
                            Администратор:
                            @if (context.User.IsInRole("Admin"))
                            {
                                <span class="badge bg-success">✅ ДА</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">❌ НЕТ</span>
                            }
                        </p>
                        <p>
                            Медработник:
                            @if (context.User.IsInRole("MedicalStaff"))
                            {
                                <span class="badge bg-success">✅ ДА</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">❌ НЕТ</span>
                            }
                        </p>
                        <p>
                            Пациент:
                            @if (context.User.IsInRole("Patient"))
                            {
                                <span class="badge bg-success">✅ ДА</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">❌ НЕТ</span>
                            }
                        </p>
                    </div>
                </div>
            </div>
        </Authorized>
        <NotAuthorized>
            <div class="row mb-4">
                <div class="col-12">
                    <div class="alert alert-warning text-center">
                        <h4>⚠️ Вы не авторизованы</h4>
                        <p>Пожалуйста, <a href="/login" class="alert-link">войдите в систему</a> или <a href="/register" class="alert-link">зарегистрируйтесь</a></p>
                    </div>
                </div>
            </div>
        </NotAuthorized>
    </AuthorizeView>

    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <h3>👨‍⚕️</h3>
                    <h5 class="card-title">Врачи</h5>
                    <p class="card-text">Поиск и управление врачебным персоналом по различным критериям</p>
                    <a href="/doctors/by-specialization" class="btn btn-primary">Перейти</a>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <h3>🏥</h3>
                    <h5 class="card-title">Пациенты</h5>
                    <p class="card-text">Учет госпитализированных и амбулаторных пациентов</p>
                    <a href="/patients/hospitalized" class="btn btn-primary">Перейти</a>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <h3>📊</h3>
                    <h5 class="card-title">Статистика</h5>
                    <p class="card-text">Анализ загрузки палат, выработки врачей</p>
                    <a href="/statistics/wards" class="btn btn-primary">Перейти</a>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <h3>⚕️</h3>
                    <h5 class="card-title">Операции</h5>
                    <p class="card-text">Учет проведенных операций</p>
                    <a href="/operations" class="btn btn-primary">Перейти</a>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <h3>📋</h3>
                    <h5 class="card-title">Документы</h5>
                    <p class="card-text">Выдача больничных, справок, расписаний</p>
                    <a href="/documents/sick-leave" class="btn btn-primary">Перейти</a>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <h3>👥</h3>
                    <h5 class="card-title">Персонал</h5>
                    <p class="card-text">Управление обслуживающим персоналом</p>
                    <a href="/staff/support" class="btn btn-primary">Перейти</a>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="alert alert-light">
                <h5>📖 Инструкция</h5>
                <ul>
                    <li>Используйте меню слева для навигации</li>
                    <li>Все запросы поддерживают фильтрацию</li>
                    <li>Система работает с PostgreSQL базой данных</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        transition: transform 0.2s, box-shadow 0.2s;
        border: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }

        .card h3 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
</style>